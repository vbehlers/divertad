<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bell Schedule - AVHS</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=home" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base font settings */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap');
        
        html {
            font-size: var(--base-font-size);
        }
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /*
         * Global style tokens (CSS Custom Properties) for easy updates.
        */
        :root {
            /* Base Font Size Token */
            --base-font-size: 16px;

            /* Color Tokens */
            --color-text-default: #111827;
            --color-text-secondary: #4b5563;
            --color-text-primary: #0051d2;

            /* Font Weight Tokens */
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;

            /* Font Size Tokens (in rem) */
            --fs-h1: 4.3rem;
            --fs-h2: 2.25rem;
            --fs-h3: 1.8rem;
            --fs-h4: 1.3rem;
            --fs-h5: 1rem;
            --fs-h6: 0.875rem;

            /* Line Height Tokens (in rem) */
            --lh-h1: 4.3rem;
            --lh-h2: 2.25rem;
            --lh-h3: 1.8rem;
            --lh-h4: 1.3rem;
            --lh-h5: 1rem;
            --lh-h6: 0.875rem;

            /* Line Height Tokens (in rem) */
            --lh-p1: 5.1rem;
            --lh-p2: 2.925rem;
            --lh-p3: 2.3rem;
            --lh-p4: 1.8rem;
            --lh-p5: 1.513rem;
            --lh-p6: 1.3rem;

            /* Heading Bottom Margin Tokens (in rem) */
            --h-margin-1: 5.75rem;
            --h-margin-2: 1.25rem;
            --h-margin-3: 1.0rem;
            --h-margin-4: 0.6rem;
            --h-margin-5: 0.5rem;
            --h-margin-6: 0.5rem;

            /* Module Spacing Tokens (in rem) */
            --module-spacing-1: 4rem;
            --module-spacing-2: 5.9rem;
            --module-spacing-3: 1.5rem;
            --module-spacing-4: 0rem;
            --module-spacing-5: 1.2rem;
            --module-spacing-6: 0.8rem;

            /* Paragraph Group Padding Tokens (in rem) */
            --group-padding-1: 6.8rem;
            --group-padding-2: 4.5rem;
            --group-padding-3: 2.3rem;
            --group-padding-4: 2.2rem;
            --group-padding-5: 1.5rem;
            --group-padding-6: 0.533rem;

            /* Proportional Paragraph Spacing Token */
            --paragraph-spacing-scale: 0.4;
        }

        /* * Hierarchical Module Spacing */
        .module-1 { margin-bottom: var(--module-spacing-1); }
        .module-2 { margin-bottom: var(--module-spacing-2); }
        .module-3 { margin-bottom: var(--module-spacing-3); }
        .module-4 { margin-bottom: var(--module-spacing-4); }
        .module-5 { margin-bottom: var(--module-spacing-5); }
        .module-6 { margin-bottom: var(--module-spacing-6); }

        /* * Paragraph Group Padding */
        .group-1 { padding-bottom: var(--group-padding-1); }
        .group-2 { padding-bottom: var(--group-padding-2); }
        .group-3 { padding-bottom: var(--group-padding-3); }
        .group-4 { padding-bottom: var(--group-padding-4); }
        .group-5 { padding-bottom: var(--group-padding-5); }
        .group-6 { padding-bottom: var(--group-padding-6); }
        
        /* * Proportional Paragraph Spacing */
        .paragraph {
            margin-bottom: calc(1.2em * var(--paragraph-spacing-scale));
        }

        /* * Typography classes using CSS variables */
        .type-h1 { font-size: var(--fs-h1); line-height: var(--lh-h1); margin-bottom: var(--h-margin-1); }
        .type-h2 { font-size: var(--fs-h2); line-height: var(--lh-h2); margin-bottom: var(--h-margin-2); }
        .type-h3 { font-size: var(--fs-h3); line-height: var(--lh-h3); margin-bottom: var(--h-margin-3); }
        .type-h4 { font-size: var(--fs-h4); line-height: var(--lh-h4); margin-bottom: var(--h-margin-4); }
        .type-h5 { font-size: var(--fs-h5); line-height: var(--lh-h5); margin-bottom: var(--h-margin-5); }
        .type-h6 { font-size: var(--fs-h6); line-height: var(--lh-h6); margin-bottom: var(--h-margin-6); }

        .type-p1 { font-size: var(--fs-h1); line-height: var(--lh-p1); }
        .type-p2 { font-size: var(--fs-h2); line-height: var(--lh-p2); }
        .type-p3 { font-size: var(--fs-h3); line-height: var(--lh-p3); }
        .type-p4 { font-size: var(--fs-h4); line-height: var(--lh-p4); }
        .type-p5 { font-size: var(--fs-h5); line-height: var(--lh-p5); }
        .type-p6 { font-size: var(--fs-h6); line-height: var(--lh-p6); }

        /* * Semantic utility classes for themes */
        .text-primary { color: var(--color-text-primary); }
        .text-secondary { color: var(--color-text-secondary); }
        .font-normal { font-weight: var(--font-normal); }
        .font-medium { font-weight: var(--font-medium); }
        .font-semibold { font-weight: var(--font-semibold); }
        .font-bold { font-weight: var(--font-bold); }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
        }

        /* Bell Schedule Specific Styles - Updated to match exact image design */
        .notification-header {
            margin-bottom: 2rem;
        }

        .header-dot {
            display: inline-block;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            background-color: #22c55e;
            margin-right: 0.5rem;
            vertical-align: middle;
        }

        .notification-panels {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            justify-content: flex-start;
        }

        .panel {
            text-align: left;
            border-left: 2px solid #e2e8f0;
            padding-left: 1rem;
            padding-right: 8rem;
            margin-left: -16px;
            margin-top: 10px;
        }

        .panel-value {
            font-size: 50px;
            font-weight: 400;
            margin-bottom: 0.5rem;
            font-family: 'Roboto', sans-serif;
            color: #0051d2;
            line-height: 1;
        }

        .panel-label {
            font-size: 16px;
            color: #111827;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
            padding-left: 8px;
        }

        .time-display {
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
        }

        /* Flashing animation for next period indicator */
        @keyframes flash-next-period {
            0% { background-color: #fff; }
            50% { background-color: #ffe5f1; }
            100% { background-color: #fff; }
        }

        .flash-next-period {
            animation: flash-next-period 1.5s infinite ease-in-out;
            background-color: #ffe5f1 !important;
        }

        /* Style borders around flashing row to complement the flash */
        .flash-next-period {
            border-top: 3px solid #ff75b3 !important;
            border-bottom: 3px solid #ff75b3 !important;
        }

        /* Smooth transitions for all changes */
        .panel-value,
        .panel-label,
        tbody tr,
        tbody td,
        tbody span {
            transition: all 0.3s ease-in-out;
        }

        /* Smooth indicator animation similar to tabs */
        tbody tr {
            transition: all 380ms cubic-bezier(0.22, 1, 0.36, 1);
        }

        tbody tr.current-period {
            border-left: 4px solid #0051d2;
            transition: border-left 380ms cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Make all border-b elements 3px thick */
        .border-b {
            border-bottom-width: 3px !important;
        }

        /* View Transitions API keyframes for smooth number changes */
        @keyframes vt-fade-in {
            from { 
                opacity: 0; 
                transform: scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: scale(1); 
            }
        }

        @keyframes vt-fade-out {
            from { 
                opacity: 1; 
                transform: scale(1); 
            }
            to { 
                opacity: 0; 
                transform: scale(0.95); 
            }
        }

        /* Material Symbols styling */
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }

        /* Sleeping emoji - static */
        .sleeping-emoji {
            display: inline-block;
        }

        /* Apply View Transitions to specific elements */
        .panel-value {
            view-transition-name: panel-value;
        }

        #current-period-header {
            view-transition-name: period-header;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .notification-panels {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="bg-white">
    <div class="w-full max-w-[1500px] px-4 md:px-6 lg:px-8 mx-auto">
        
        <!-- Start Module 1 -->
        <div class="module-1">
            
            <!-- Start Module 2 - Bell Schedule Notifications -->
            <div class="module-2 vt-page-scope">

                <!-- Start Module 3 -->
                <div class="module-3">
                    <!-- Heading/Paragraph Group 3 -->
                    <div class="group-3">
                        <h3 class="type-h3 font-normal">
                            <span id="current-date-header">Tuesday, March 19</span>
                        </h3>
                        
                        <!-- Schedule Type -->
                        <div class="notification-header">
                            <div class="text-left">
                                <div class="text-base font-normal text-gray-900 mt-1" id="schedule-type-display">Regular Schedule</div>
                            </div>
                        </div>

                        <!-- Test Buttons -->
                        <div class="mt-4 mb-4">
                            <div class="flex space-x-2 flex-wrap">
                                <button onclick="testSchedule('regular_day')" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                                    Test Regular
                                </button>
                                <button onclick="testSchedule('flex_day')" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                                    Test Flex
                                </button>
                                <button onclick="testSchedule('minimum_day')" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                                    Test Min Day
                                </button>
                                <button onclick="testAfterHours()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                                    Test After Hours
                                </button>
                                <button onclick="resetSchedule()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                                    Reset
                                </button>
                            </div>
                        </div>

                        <!-- Three Panel Notification System -->
                        <div class="notification-panels">
                            
                            <!-- Current Period Panel (KPI #1) -->
                            <div class="panel">
                                <div class="panel-value" id="current-period-kpi">0</div>
                                <div class="panel-label">Current Period</div>
                            </div>

                            <!-- Current Time Panel -->
                            <div class="panel">
                                <div class="panel-value" id="current-time">8:38:01</div>
                                <div class="panel-label">Current Time</div>
                            </div>

                            <!-- Next Bell Panel -->
                            <div class="panel">
                                <div class="panel-value" id="next-bell">10:49 / 116:23m</div>
                                <div class="panel-label">Next Bell</div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- End Module 3 -->

                <!-- Start Module 3 -->
                <div class="module-3">
                    <!-- Heading/Paragraph Group 3 -->
                    <div class="group-3">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="border-b-3 border-gray-200">
                                        <th class="type-h5 text-primary font-normal py-4 pr-4 w-1/6">Period</th>
                                        <th class="type-h5 text-primary font-normal p-4 w-1/3">Time</th>
                                        <th class="type-h5 text-primary font-normal p-4 w-1/6">Duration</th>
                                        <th class="type-h5 text-primary font-normal p-4 w-1/6">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule-table-body">
                                    <!-- Dynamic content will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- End Module 3 -->

                <!-- Start Module 3 -->
                <div class="module-3">
                    <!-- Heading/Paragraph Group 3 -->
                    <div class="group-3">
                        <div class="flex justify-start space-x-4">
                            <button data-modal-target="#scheduleModal" class="bg-gray-600 hover:bg-gray-700 text-white font-normal py-3 px-6 rounded-lg transition-colors">
                                View Full Schedule
                            </button>
                            <button onclick="openCalendarModal()" class="bg-gray-600 hover:bg-gray-700 text-white font-normal py-3 px-6 rounded-lg transition-colors">
                                View Calendar
                            </button>
                        </div>
                    </div>
                </div>
                <!-- End Module 3 -->

            </div>
            <!-- End Module 2 -->

        </div>
        <!-- End Module 1 -->
        
    </div>

    <!-- Full Schedule Modal -->
    <div id="scheduleModal" class="fixed inset-0 bg-white z-50" style="display: none;">
        <!-- Sticky Header - Full Width -->
        <header class="sticky top-0 bg-white border-b border-gray-200 px-4 md:px-10 lg:px-10 py-6 z-20 shadow-sm">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-medium text-gray-800 font-sans">Complete Bell Schedule - AVHS</h2>
                <button data-modal-close id="closeModalIconBtn" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </header>
    
        <!-- Scrollable Content Container -->
        <div class="h-full overflow-y-auto pt-0">
            <!-- Content - Centered with max-width 1000px -->
            <div class="max-w-[1000px] mx-auto px-4 md:px-10 lg:px-10 py-8 font-sans">
                <div id="modal-schedule-content">
                    <!-- Dynamic schedule content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Load the district schedules data first, then the manager -->
    <script src="district-schedules.js"></script>
    <script src="enhanced-bell-schedule-manager.js"></script>
    
    <script>
        // Initialize the enhanced bell schedule system
        document.addEventListener('DOMContentLoaded', function() {
            // Check if required data is available
            if (typeof districtSchedules === 'undefined') {
                console.error('districtSchedules not loaded');
                document.body.innerHTML = '<div style="padding: 20px; color: red;">Error: District schedules data not loaded. Please check the JavaScript files.</div>';
                return;
            }
            
            if (typeof EnhancedBellScheduleManager === 'undefined') {
                console.error('EnhancedBellScheduleManager not loaded');
                document.body.innerHTML = '<div style="padding: 20px; color: red;">Error: Enhanced Bell Schedule Manager not loaded. Please check the JavaScript files.</div>';
                return;
            }
            
            try {
                console.log('Starting initialization...');
                console.log('districtSchedules:', districtSchedules);
                console.log('EnhancedBellScheduleManager:', EnhancedBellScheduleManager);
                
                // Initialize the enhanced manager for AVHS
                const bellManager = new EnhancedBellScheduleManager(districtSchedules, 'AVHS');
                console.log('Manager created:', bellManager);
                
                // Start auto-updating
                bellManager.startAutoUpdate();
                
                // Make it globally available
                window.bellManager = bellManager;
                
                // Initialize modal functionality
                initializeModal();
                
                console.log('AVHS Bell Schedule System initialized successfully');
            } catch (error) {
                console.error('Error initializing bell schedule system:', error);
                console.error('Error stack:', error.stack);
                document.body.innerHTML = '<div style="padding: 20px; color: red;">Error initializing bell schedule system: ' + error.message + '</div>';
            }
        });

        function initializeModal() {
            // Modal functionality
            function openModal(modal) {
                if (modal) {
                    modal.style.display = 'block';
                    // Update modal content
                    updateModalContent();
                }
            }

            function closeModal(modal) {
                if (modal) modal.style.display = 'none';
            }

            function updateModalContent() {
                const content = document.getElementById('modal-schedule-content');
                
                if (content && window.bellManager) {
                    content.innerHTML = window.bellManager.generateModalContent();
                }
            }

            // Bind modal events
            document.querySelectorAll('[data-modal-target]').forEach((btn) => {
                btn.addEventListener('click', () => {
                    const sel = btn.getAttribute('data-modal-target');
                    const modal = sel ? document.querySelector(sel) : null;
                    openModal(modal);
                });
            });

            document.querySelectorAll('[data-modal-close]').forEach((btn) => {
                btn.addEventListener('click', () => {
                    const modal = btn.closest('.fixed');
                    closeModal(modal);
                });
            });

            document.querySelectorAll('.fixed').forEach((modal) => {
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) closeModal(modal);
                });
            });
        }

        // Test functions for schedule simulation
        function testSchedule(scheduleType) {
            if (window.bellManager) {
                console.log(`Testing ${scheduleType} schedule`);
                
                // Set schedule type override
                window.bellManager.scheduleTypeOverride = scheduleType;
                
                // Force update
                window.bellManager.updateDashboard();
                
                // Show feedback
                const buttons = document.querySelectorAll('button[onclick^="testSchedule"]');
                buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-blue-500'));
                
                const activeButton = document.querySelector(`button[onclick="testSchedule('${scheduleType}')"]`);
                if (activeButton) {
                    activeButton.classList.add('ring-2', 'ring-blue-500');
                }
            }
        }

        function testAfterHours() {
            if (window.bellManager) {
                console.log('Testing after hours scenario');
                
                // Set a time that's definitely after school hours (e.g., 10:00 PM)
                const afterHoursDate = new Date();
                afterHoursDate.setHours(22, 0, 0, 0); // 10:00 PM
                window.bellManager.dateOverride = afterHoursDate;
                
                // Force update
                window.bellManager.updateDashboard();
                
                // Debug: Check what the current period is
                const kpiData = window.bellManager.getKPIData();
                console.log('After hours KPI data:', kpiData);
                console.log('Current period:', kpiData.currentPeriod);
                
                // Show feedback
                const buttons = document.querySelectorAll('button[onclick^="test"]');
                buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-blue-500'));
                
                const activeButton = document.querySelector('button[onclick="testAfterHours()"]');
                if (activeButton) {
                    activeButton.classList.add('ring-2', 'ring-blue-500');
                }
            }
        }

        function resetSchedule() {
            if (window.bellManager) {
                console.log('Resetting to normal schedule');
                
                // Clear overrides
                window.bellManager.scheduleTypeOverride = null;
                window.bellManager.dateOverride = null;
                
                // Force update
                window.bellManager.updateDashboard();
                
                // Remove active styling
                const buttons = document.querySelectorAll('button[onclick^="test"]');
                buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-blue-500'));
            }
        }

        // Calendar modal functions
        function openCalendarModal() {
            if (window.bellManager) {
                const modal = document.getElementById('calendar-modal');
                const content = document.getElementById('calendar-content');
                const schoolName = document.getElementById('modal-school-name');
                
                // Set school name
                schoolName.textContent = window.bellManager.currentSchool.school_name;
                
                // Generate calendar content
                content.innerHTML = generateCalendarContent();
                
                // Show modal (same as schedule modal)
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeCalendarModal() {
            const modal = document.getElementById('calendar-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function generateCalendarContent() {
            if (!window.bellManager) return '<p>Error: Bell manager not available</p>';
            
            const school = window.bellManager.currentSchool;
            const allDates = [];
            
            // Collect all dates from different categories
            if (school.holidays_and_important_dates) {
                const dates = school.holidays_and_important_dates;
                
                // Add holidays
                if (dates.holidays) {
                    dates.holidays.forEach(holiday => {
                        allDates.push({
                            date: new Date(holiday.start_date),
                            endDate: holiday.end_date ? new Date(holiday.end_date) : null,
                            type: 'holiday',
                            name: holiday.name,
                            description: holiday.name
                        });
                    });
                }
                
                // Add non-student days
                if (dates.non_student_days) {
                    dates.non_student_days.forEach(day => {
                        allDates.push({
                            date: new Date(day.date),
                            type: 'non_student',
                            name: day.description,
                            description: day.description
                        });
                    });
                }
                
                // Add back-to-school nights
                if (dates.back_to_school_nights) {
                    dates.back_to_school_nights.forEach(event => {
                        allDates.push({
                            date: new Date(event.date),
                            type: 'back_to_school',
                            name: event.description,
                            description: event.description
                        });
                    });
                }
                
                // Add end of quarter/semester dates
                if (dates.end_of_quarter_semester_dates) {
                    dates.end_of_quarter_semester_dates.forEach(event => {
                        allDates.push({
                            date: new Date(event.date),
                            type: 'end_quarter',
                            name: event.name,
                            description: event.name
                        });
                    });
                }
                
                // Add testing dates
                if (dates.testing_dates) {
                    dates.testing_dates.forEach(test => {
                        allDates.push({
                            date: new Date(test.start_date),
                            endDate: test.end_date ? new Date(test.end_date) : null,
                            type: 'testing',
                            name: test.test_name,
                            description: test.test_name + (test.note ? ' - ' + test.note : '')
                        });
                    });
                }
                
                // Add other minimum days with activities
                if (dates.other_minimum_days_with_activities) {
                    dates.other_minimum_days_with_activities.forEach(event => {
                        allDates.push({
                            date: new Date(event.date),
                            type: 'activity',
                            name: event.description,
                            description: event.description
                        });
                    });
                }
                
                // Add flex days (if they exist in the data)
                if (dates.flex_days) {
                    dates.flex_days.forEach(event => {
                        allDates.push({
                            date: new Date(event.date),
                            type: 'flex_day',
                            name: event.description,
                            description: event.description
                        });
                    });
                }
                
                // Add minimum days (if they exist in the data)
                if (dates.minimum_days) {
                    dates.minimum_days.forEach(event => {
                        allDates.push({
                            date: new Date(event.date),
                            type: 'minimum_day',
                            name: event.description,
                            description: event.description
                        });
                    });
                }
            }
            
            // Sort dates chronologically
            allDates.sort((a, b) => a.date - b.date);
            
            // Generate HTML (same styling as schedule modal)
            let html = '';
            
            // Academic year info
            html += `
                <div class="mb-12">
                    <div class="mb-6">
                        <h3 class="type-h3 font-normal text-primary">Academic Year Information</h3>
                        <p class="type-p5 text-gray-600 mt-2">Important dates and information for the current academic year.</p>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <tbody>
                                <tr>
                                    <td class="type-p5 py-4 pr-4 font-medium text-left">Academic Year</td>
                                    <td class="type-p5 p-4 text-left">${school.general_academic_info.academic_year}</td>
                                </tr>
                                <tr>
                                    <td class="type-p5 py-4 pr-4 font-medium text-left">First Day</td>
                                    <td class="type-p5 p-4 text-left">${new Date(school.general_academic_info.first_day_of_school).toLocaleDateString()}</td>
                                </tr>
                                <tr>
                                    <td class="type-p5 py-4 pr-4 font-medium text-left">Last Day</td>
                                    <td class="type-p5 p-4 text-left">${new Date(school.general_academic_info.last_day_of_school).toLocaleDateString()}</td>
                                </tr>
                                ${school.general_academic_info.graduation_date ? `
                                <tr>
                                    <td class="type-p5 py-4 pr-4 font-medium text-left">Graduation</td>
                                    <td class="type-p5 p-4 text-left">${school.general_academic_info.graduation_date}</td>
                                </tr>
                                ` : ''}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // Calendar events
            html += '<div class="mb-12">';
            html += '<div class="mb-6">';
            html += '<h3 class="type-h3 font-normal text-primary">Important Dates & Events</h3>';
            html += '<p class="type-p5 text-gray-600 mt-2">All holidays, special days, and important events throughout the academic year.</p>';
            html += '</div>';
            
            if (allDates.length === 0) {
                html += '<p class="type-p5 text-gray-500 italic">No calendar events found.</p>';
            } else {
                html += '<div class="overflow-x-auto">';
                html += '<table class="w-full text-left">';
                html += '<thead>';
                html += '<tr>';
                html += '<th class="type-h5 text-primary font-normal py-4 pr-4 w-1/3 text-left">Date</th>';
                html += '<th class="type-h5 text-primary font-normal p-4 w-1/3 text-left">Event</th>';
                html += '<th class="type-h5 text-primary font-normal p-4 w-1/3 text-left">Type</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                
                allDates.forEach(event => {
                    const dateStr = event.date.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    const endDateStr = event.endDate ? 
                        ' - ' + event.endDate.toLocaleDateString('en-US', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }) : '';
                    
                    const typeLabels = {
                        'holiday': 'Holiday',
                        'non_student': 'Non-Student Day',
                        'back_to_school': 'Back to School',
                        'end_quarter': 'End of Quarter',
                        'testing': 'Testing',
                        'activity': 'Activity Day',
                        'flex_day': 'Flex Day',
                        'minimum_day': 'Minimum Day'
                    };
                    
                    const typeColors = {
                        'holiday': 'text-red-600',
                        'non_student': 'text-yellow-600',
                        'back_to_school': 'text-green-600',
                        'end_quarter': 'text-blue-600',
                        'testing': 'text-purple-600',
                        'activity': 'text-orange-600',
                        'flex_day': 'text-indigo-600',
                        'minimum_day': 'text-pink-600'
                    };
                    
                    html += `
                        <tr>
                            <td class="type-p5 py-4 pr-4 whitespace-nowrap text-left">${dateStr}${endDateStr}</td>
                            <td class="type-p5 p-4 whitespace-nowrap text-left">${event.name}</td>
                            <td class="type-p5 p-4 whitespace-nowrap text-left ${typeColors[event.type]}">${typeLabels[event.type]}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody>';
                html += '</table>';
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }

    </script>

    <!-- Calendar Modal -->
    <div id="calendar-modal" class="fixed inset-0 bg-white z-50" style="display: none;">
        <!-- Sticky Header - Full Width -->
        <header class="sticky top-0 bg-white border-b border-gray-200 px-4 md:px-10 lg:px-10 py-6 z-20 shadow-sm">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-medium text-gray-800 font-sans">Academic Calendar - <span id="modal-school-name">AVHS</span></h2>
                <button onclick="closeCalendarModal()" id="closeCalendarModalIconBtn" class="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </header>
    
        <!-- Scrollable Content Container -->
        <div class="h-full overflow-y-auto pt-0">
            <!-- Content - Centered with max-width 1400px -->
            <div class="max-w-[1400px] mx-auto px-4 md:px-10 lg:px-10 py-8 font-sans">
                <div id="calendar-content">
                    <!-- Calendar content will be generated here -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>
